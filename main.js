(()=>{"use strict";var e=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button_inactive"):t.classList.add("popup__button_inactive")},t={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"b458334e-7861-4969-a846-80e383dd8a22","Content-Type":"application/json"}},n=function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log("Ошибка: ".concat(e))}))},o=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log("Ошибка: ".concat(e))}))},c=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log("Ошибка: ".concat(e))}))},r=document.querySelector(".popup_type_edit"),u=document.querySelector(".popup_type_new-card"),a=document.querySelector(".popup_type_image"),i=document.querySelector(".popup_type_avatar");r.classList.add("popup_is-animated"),u.classList.add("popup_is-animated"),a.classList.add("popup_is-animated"),i.classList.add("popup_is-animated");var l=document.querySelector(".profile__edit-button"),s=document.querySelector(".profile__add-button"),p=(document.querySelector(".card__image"),document.querySelector(".profile__image-place"));function d(e,t,r){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=_.querySelector(".card").cloneNode(!0);l.querySelector(".card__image").src=t,l.querySelector(".card__image").alt=r,l.querySelector(".card__title").textContent=e,l.querySelector(".card__like-counter").textContent=u;var s=l.querySelector(".card__like-button");null!==i&&s.addEventListener("click",(function(){s.classList.toggle("card__like-button_is-active"),s.classList.contains("card__like-button_is-active")?o(i).then((function(e){l.querySelector(".card__like-counter").textContent=e.likes.length})).catch((function(e){console.log("Ошибка: ".concat(e))})):c(i).then((function(e){l.querySelector(".card__like-counter").textContent=e.likes.length})).catch((function(e){console.log("Ошибка: ".concat(e))}))}));var p=l.querySelector(".card__delete-button");return null!==i&&p.addEventListener("click",(function(){n(i),l.remove()})),l.querySelector(".card__image").addEventListener("click",(function(){h(a),a.querySelector(".popup__close").addEventListener("click",(function(){return y(a)})),m(a),a.querySelector(".popup__image").src=t,a.querySelector(".popup__image").alt=r,a.querySelector(".popup__caption").textContent=e})),l}var _=document.querySelector("#card-template").content,f=document.querySelector(".places__list");function h(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",S)}function y(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",S)}function v(){h(u),u.querySelector(".popup__close").addEventListener("click",(function(){return y(u)})),m(u);var e=u.querySelector(".popup__form"),r=u.querySelector(".popup__input_type_card-name"),a=u.querySelector(".popup__input_type_url");e.addEventListener("submit",(function(i){i.preventDefault(),q(!0,e.querySelector(".popup__button"));var l,s,p=r.value,_=a.value;(l=p,s=_,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:l,link:s})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){v=d(p,_,"photo"),f.prepend(v),v.querySelector(".card__delete-button").addEventListener("click",(function(){n(e._id),v.remove()}));var t=v.querySelector(".card__like-button");t.addEventListener("click",(function(){t.classList.toggle("card__like-button_is-active"),t.classList.contains("card__like-button_is-active")?o(e._id).then((function(e){v.querySelector(".card__like-counter").textContent=e.likes.length})).catch((function(e){console.log("Ошибка: ".concat(e))})):c(e._id).then((function(e){v.querySelector(".card__like-counter").textContent=e.likes.length})).catch((function(e){console.log("Ошибка: ".concat(e))}))}))})).then((function(){return y(u)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){q(!1,e.querySelector(".popup__button")),r.value="",a.value=""}))}))}l.addEventListener("click",(function(){h(r),r.querySelector(".popup__close").addEventListener("click",(function(){return y(r)})),m(r);var e=r.querySelector(".popup__form"),n=r.querySelector(".popup__input_type_name"),o=r.querySelector(".popup__input_type_description");e.addEventListener("submit",(function(c){var u,a;c.preventDefault(),q(!0,e.querySelector(".popup__button")),(u=n.value,a=o.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:u,about:a})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about})).then((function(){return y(r)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){q(!1,e.querySelector(".popup__button")),n.value="",o.value=""}))}))}));var m=function(e){e.addEventListener("click",(function(t){t.target===e&&y(e)}))};function S(e){"Escape"===e.key&&y(document.querySelector(".popup_is-opened"))}function q(e,t){console.log(e,t.textContent),t.textContent=e?"Сохранение...":"Сохранить"}s.addEventListener("click",v),Array.from(document.querySelectorAll(".popup__form")).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t){var n=Array.from(t.querySelectorAll(".popup__input")),o=t.querySelector(".popup__button");e(n,o),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.textContent="",n.classList.remove("popup__input-error_active")}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__input-error_active")}(e,t,t.validationMessage)}(t,c),e(n,o)}))}))}(t)}));var g=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),L=fetch("".concat(t.baseUrl,"/users/me"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log("Ошибка: ".concat(e))}));p.addEventListener("click",(function(){h(i),i.querySelector(".popup__close").addEventListener("click",(function(){return y(i)})),m(i);var e=i.querySelector(".popup__form"),n=e.querySelector(".popup__input_type_url");i.addEventListener("submit",(function(o){var c;o.preventDefault(),q(!0,e.querySelector(".popup__button")),(c=n.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){b.setAttribute("src",e.avatar)})).then((function(){y(i)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){q(!1,e.querySelector(".popup__button")),n.value=""}))}))})),L.then((function(e){g.textContent=e.name,k.textContent=e.about,b.setAttribute("src",e.avatar)})).catch((function(e){console.log("Ошибка: ".concat(e))})),fetch("".concat(t.baseUrl,"/cards"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){console.log("Ошибка: ".concat(e))})).then((function(e){e.forEach((function(e){var t=d(e.name,e.link,"photo",e.likes.length,e._id);f.append(t),L.then((function(n){e.owner._id!==n._id&&function(e){e.querySelector(".card__delete-button").classList.add("card__delete-button_inactive")}(t)})).catch((function(e){console.log("Ошибка: ".concat(e))}))}))})).catch((function(e){console.log("Ошибка: ".concat(e))}))})();